---
title: 'Exercise 2_1_1: Selecting & renaming variables'
author: 'Johannes Breuer, Stefan JÃ¼nger, & Veronika Batzdorfer'
date: 'Introduction to R for Data Analysis'
---

```{r child = "./content/config/exercises_setup.Rmd"}
```


As in the presentation, we will use data from the [German General Social Survey - Allbus 2021](https://search.gesis.org/research_data/ZA5280) for this exercise. You should (have) download(ed) the dataset in `.sav` format and saved it in a folder caller `data` within the folder containing the materials for this workshop. Also remember that it is helpful to consult the [codebook for the data set](https://search.gesis.org/research_data/ZA5280).
That being sad, let's get wrangling...

...but before we can do that, we need to load the `tidyverse` and `haven` package(s) and import the data.

```{r read-data, message = F}
library (tidyverse)
library (haven)

allbus_2021 <- read_sav("./data/allbus_2021ZA5280_v1-0-0.sav",
                       user_na = TRUE) %>% 
  remove_all_labels() %>% 
  as_tibble()
```

```{block, box.title = "1", box.body = list(fill = "white"), box.icon = "fa-star"}
Before we apply any changes to our data, let's first pipe them into a function to catch a glimpse (hint hint). 
```

```{block, opts.label = "clues"}
The clue for this task is already "hidden" in the text of the task ;-)
```

```{r first-exercise, solution = TRUE}
allbus_2021 %>% 
  glimpse()
```

```{block, box.title = "2", box.body = list(fill = "white"), box.icon = "fa-star"}
Using `base R`, create a new object called `allbus_institut_trust` that contains all variables that assess how much people trust institutions (e.g., European Commission, Bundestag, police). To find the required variable names, you can check the [codebook]((https://dbk.gesis.org/dbksearch/download.asp?id=67378)) (search for "trust") or have a look at the clue for this task.
```

```{block, opts.label = "clues"}
The first variable we want to select for our subset is named `pt01`, and the last one is `pt20`. They appear consecutively in the data set. Remember that there are two options for selecting columns in `base R`: One is subsetting using [ ], the other is the `subset()` function.
```

```{r second-exercise, solution = TRUE}
# Option 1
allbus_institut_trust <- allbus_2021[, c("pt01",
                               "pt02",
                               "pt03",
                               "pt04",
                               "pt06",
                               "pt07",
                               "pt08",
                               "pt09",
                               "pt10",
                               "pt11",
                               "pt12",
                               "pt14",
                               "pt15",
                               "pt19",
                               "pt20")]
# Option 2
allbus_institut_trust  <- subset(allbus_2021, TRUE, select = c(pt01:pt20))

```

```{block, box.title = "3", box.body = list(fill = "white"), box.icon = "fa-star"}
Use a function from the `dplyr` package to create a new object named `allbus_2021_info` that only contains the (binary) variables that asked about the use of different devices for the individual Internet consumption. Again, you can consult the code book to find the right variable names (search for "Internet") or have a look at the clue for this task, instead.
```

```{block, opts.label = "clues"}
The first variable we want to select for our subset is named `lm27`, and the last one is `lm34`. They appear consecutively in the data set.
```

```{r third-exercise, solution = TRUE}
allbus_2021_info <- allbus_2021 %>% 
  select(lm27:lm34)
```

```{block, box.title = "4", box.body = list(fill = "white"), box.icon = "fa-star"}
Again, using a function from the `tidyverse` package `dplyr`, select only the character variables from the `allbus_2021` data set and assign them to an object named `allbus_char`.
```

```{block, opts.label = "clues"}
You need to use the selection helper `where()` for this task.
```

```{r fourth-exercise, solution = TRUE}
allbus_2021_char <-allbus_2021 %>% 
  select(where(is.character))
```



```{block, box.title = "5", box.body = list(fill = "white"), box.icon = "fa-star"}
After creating subsets of variables, let's now rename those variables using `dplyr` functions again for the `allbus_2021_info` object in one step.
First, rename the variables `lm27` to `internet_use_pc`, `lm28` to `internet_use_laptop`, and `lm29` to `internet_use_tablet`.
Then rename the variables `lm30` `lm31` `lm32` `lm33` , and `lm34` to `internet_use_smartphone`, `internet_use_TV`, `internet_use_playstation`, `internet_use_ebook`, and `internet_use_other`, respectively, using a function from `dplyr`. 


```

```{block, opts.label = "clues"}
You can also rename variables within the `select()` command.
```

```{r fifth-exercise, solution = TRUE}
allbus_2021_info <- allbus_2021 %>% 
  select(internet_use_pc = lm27,
         internet_use_laptop = lm28,
         internet_use_tablet = lm29,
         internet_use_smartphone = lm30,
         internet_use_TV = lm31,
         internet_use_playstation = lm32,
         internet_use_ebook = lm33,
         internet_use_other = lm34)
```

```{block, box.title = "6", box.body = list(fill = "white"), box.icon = "fa-star"}
As the final task in this set of exercises, do the previous selection and renaming procedure in `base R`. 
That is, first rename the variables `lm27` to `internet_use_pc`, `lm28` to `internet_use_laptop`, and `lm29` to `internet_use_tablet` with `base R`.

Then, rename the variables `lm30` `lm31` `lm32` `lm33` , and `lm34` to `internet_use_smartphone`, `internet_use_TV`, `internet_use_playstation`, `internet_use_ebook`, and `internet_use_other`, respectively, using a function from `dplyr`. 

When using the `dplyr` function for renaming the variables, assign the result to the same object name as before (i.e., overwrite the `internet_use_pc` object).
```
```

```{block, opts.label = "clues"}
The `base R` function we need here is `colnames()`, and the `dplyr` function is `rename()`. Remember that the correct syntax the `rename()` function is `new_name = old_name`.
```

```{r sixth-exercise, solution = TRUE}

colnames(allbus_2021)[colnames(allbus_2021) == "lm27"] <- "internet_use_pc"
colnames(allbus_2021)[colnames(allbus_2021) == "lm28"] <- "internet_use_laptop"
colnames(allbus_2021)[colnames(allbus_2021) == "lm29"] <- "internet_use_tablet"

# tidyverse (dplyr)
allbus_2021_info <- allbus_2021 %>% 
  rename(internet_use_smartphone = lm30,
         internet_use_TV = lm31,
         internet_use_playstation = lm32,
         internet_use_ebook = lm33,
         internet_use_other = lm34)
```



