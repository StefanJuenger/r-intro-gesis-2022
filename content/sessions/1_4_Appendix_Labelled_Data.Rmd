---
title: "Introduction to R for Data Analysis"
subtitle: "Appendix: Labelled Data"
author: "Johannes Breuer, Stefan JÃ¼nger, & Veronika Batzdorfer"
date: "2022-08-15"
presenter: Stefan
editor_options: 
  chunk_output_type: console
---
layout: true 

```{r child = "./content/config/sessions_setup.Rmd"}
```

---

## Beyond flat files: labelled data

A lot of data comes in some sort of flat file format, such as `CSV`. In the social sciences, however, we often deal with proprietary file formats, such as *SPSS*'s `.sav` or *Stata*'s `.dta` files. 

What these data typically include are labels. These labels are used to describe variables or variable values. They comprise some specific metadata inherent in these proprietary file formats. 

*If you were able to travel back ten years in time and ask an `R` geek, she'd say that you cannot use labels in R. You'd either have to import, e.g., value labels as character strings or use their codes as factors. However, these days...*

---

## Not being able to use labelled data is a thing of the past

Nowadays, if you use the `haven` package, labels are built-in for the corresponding file types. For example:

```{r read-spss}
allbus_2021 <-
  haven::read_sav("./data/allbus_2021/ZA5280_v1-0-0.sav")

allbus_2021["agec"]
```

---

## Advantages of using labelled data

One could rejoice in not having to use a codebook anymore, just like in *SPSS* (although just looking at code output for glimpsing feels much more... data-geeky). 

An advantage is definitely that you can potentially re-use the labels in figures and plots, and some `R` packages do that automatically, such as the [`sjPlot`](https://strengejacke.github.io/sjPlot/) package.

In addition, when you exchange your data with colleagues who do not use `R` or when you plan to publish your data (which you always should if that is possible), being able to export data you have manipulated in `R` in different formats is great.

**However, be aware of the missing values hell that you may enter due to different missing value definitions in *Stata* and *SPSS*.**

---

## Getting labels

For variables:

```{r get-labels}
sjlabelled::get_label(allbus_2021$agec)
```

For values:

.tinyish[
```{r get-values}
sjlabelled::get_labels(allbus_2021$agec)
```
]

---

## Setting labels: Variables

```{r}
allbus_2021$agec <- 
  sjlabelled::set_label(allbus_2021$agec, label = "Age, categorized")

sjlabelled::get_label(allbus_2021$agec)
```

---

## Setting labels: Values
.tinyish[
```{r}
allbus_2021$agec <- 
  sjlabelled::set_labels(
    allbus_2021$agec,
    labels = 
      c(
        "18-29 years", "30-44 years", "45-59 years", "60-74 years", 
        "75-89 years", "Over 89 years"
      )
  )

sjlabelled::get_labels(allbus_2021$agec)
```
]
